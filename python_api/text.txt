def note4bar(grouped):

    # ðŸ”’ Normalize grouped to Series
    if isinstance(grouped, pd.DataFrame):
        category_totals = grouped.sum(axis=1)
    else:  # Series
        category_totals = grouped

    # Top & Bottom
    T3 = category_totals.sort_values(ascending=False).head(3).to_dict()
    L3 = category_totals.sort_values().head(3).to_dict()

    # Central tendency
    avg_value = category_totals.mean()
    median_value = category_totals.median()

    # Closest to average
    closest_to_avg = (
        (category_totals - avg_value)
        .abs()
        .sort_values()
        .head(2)
        .index
    )
    closest_to_avg_vals = category_totals.loc[closest_to_avg].to_dict()

    # IQR & outliers
    Q1 = category_totals.quantile(0.25)
    Q2 = category_totals.quantile(0.5)
    Q3 = category_totals.quantile(0.75)
    IQR = Q3 - Q1

    outliers = category_totals[
        (category_totals < Q1 - 1.5 * IQR) |
        (category_totals > Q3 + 1.5 * IQR)
    ].to_dict()

    # Insights
    insights = []

    top_cat, top_val = category_totals.idxmax(), category_totals.max()
    low_cat, low_val = category_totals.idxmin(), category_totals.min()

    insights.append(
        f"\nThe highest performing category is '{top_cat}' with a total value of {top_val:.2f}.\n"
    )
    insights.append(
        f"The lowest performing category is '{low_cat}' with a total value of {low_val:.2f}.\n"
    )
    insights.append(
        f"The average value across all categories is {avg_value:.2f}, with a median of {median_value:.2f}.\n"
    )

    for cat, val in closest_to_avg_vals.items():
        insights.append(
            f"The category '{cat}' ({val:.2f}) is close to the overall average.\n"
        )

    if outliers:
        insights.append(
            "Outliers detected in categories: " +
            ", ".join([f"{k} ({v:.2f})" for k, v in outliers.items()])+"\n"
        )
    else:
        insights.append("No significant outliers were detected in the data.\n")
    
    for i in insights:
       note=i

    note+="\nTop 3 Bars:\n"
    for key,value in T3.items():
        note+=key+">>>"+str(value)+"\n"
    note+="\nBottom 3 Bars:\n"
    for key,value in L3.items():
        note+=key+">>>"+str(value)+"\n"
    note+="\nAverage value: "+str(avg_value)+"\nMedian value: "+str(median_value)+"\n"
    note+="\nclosest bars to avg values are:\n"
    for key,value in closest_to_avg_vals.items():
        note=note+key+">>>"+str(value)+"\n"
    note+="\nFirst Quartile: "+str(Q1)+"\nSecond Quartile: "+str(Q2)+"\nThird Quartile: "+str(Q3)+"\n"
    note+="\nOutliers:\n"
    if outliers.items():
       for key,value in outliers.items():
        note+=key+">>>"+str(value)+"\n"
    else:
       note+="None\n"

    

    note+="\n"
    return note
